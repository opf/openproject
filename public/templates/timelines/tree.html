<tr ng-repeat="node in nodes"
    ng-class="{
      'tl-first-row': $first,
      'tl-last-row': $last,
      'tl-grouping': timeline.isGrouping(),
      'tl-project-row': node.payload.is(Timeline.Project)
    }"
    ng-show="node.ancestors | ancestorsExpanded">

  <td ng-if="timeline.isGrouping() && node.payload.is(Timeline.Project) && node.level === 0 && node.group !== nodes[$index-1].group" class="tl-grouping" colspan="{{timeline.options.columns.length + 1}}">
    <span class="tl-word-ellipsis">
      {{timeline.escape(node.payload.getFirstLevelGroupingName())}}
    </span>
  </td>

  <td tree-node
      ng-class="[
        'tl-first-column',
        'tl-indent-' + node.level,
        node.childNodes.length > 0 && (node.isExpanded() && 'tl-expanded' || 'tl-collapsed')
      ]">
    <a ng-click="node.expanded = !node.expanded" ng-show="node.childNodes.length > 0">
      {{node.expanded && '-' || '+'}}
    </a>

    <span class="tl-word-ellipsis">
      <span>
        <a title="{{timeline.i18n('timelines.change')}}"
           ng-class="{
             'icon tl-icon-added': node.payload.is(Timeline.PlanningElement) && node.payload.isNewlyAdded(),
             'icon tl-icon-deleted': node.payload.is(Timeline.PlanningElement) && node.payload.isDeleted(),
             'icon tl-icon-changed': node.payload.is(Timeline.PlanningElement) && node.payload.hasAlternateDates()
           }" />
      </span>

      <span>
        <a data-modal title="{{node.text}}" ng-href"{{node.url}}" ng-class="{'tl-discreet-link': true, 'tl-project': node.payload.is(Timeline.Project)}">
          {{node.text}}
        </a>
      </span>
    </span>
  </td>

  <td option-column ng-repeat="option in timeline.options.columns">
    <span class="tl-historical" ng-show="isDateOption(option) && node.payload.does_historical_differ(option)">
      <a href="javascript://" title="{{timeline.i18n('timelines.change')}}"
         ng-class="[
           'icon',
           'tl-icon-' + (node.payload | historicalDateKind:option)
         ]">
        {{node.payload.historical()[option] || timeline.i18n('timelines.empty')}}
      </a>
      <br/>
    </span>

    <span ng-class="[
      'tl-column',
      isDateOption(option) && 'tl-current',
      isDateOption(option) && node.payload.does_historical_differ(option) && 'tl-' + (node.payload | historicalDateKind:option)
    ]">
      {{node.payload | getOptionColumn:option}}
    </span>
  </td>

</tr>
