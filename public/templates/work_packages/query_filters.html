<fieldset id="filters"
          class="header_collapsible collapsible"
          ng-class="{collapsed: !showFilters }">
  <legend ng-click="showFilters = !showFilters" title="{{showFilters && 'Hide' || 'Show'}} filters">
    <a href="">
      {{ I18n.t('js.work_packages.label_filter_add') }}
      <span class="hidden-for-sighted">{{ showFilters ? I18n.t('js.label_expanded') : I18n.t('js.label_collapsed') }}</span>
    </a>
  </legend>

  <div slide-toggle
       speed="fast"
       collapsed="!showFilters"
       class="filter-fields slide-animation">

    <table width="100%">
      <tbody>
        <tr>
          <td>

            <table>
              <tbody>
                <tr query-filter
                    ng-repeat="filter in query.filters"
                    ng-show="!filter.deactivated"
                    id="tr_{{filter.name}}"
                    class="filter">

                  <!-- Hidden for form -->
                  <input id="h_{{ filter.name }}" name="f[]" type="hidden" value="{{ filter.name }}" ng-disabled="filter.deactivated"/>

                  <!-- Name -->
                  <td style="width:200px;">
                    {{query.available_work_package_filters[filter.name].name}}
                  </td>

                  <!-- Operator -->
                  <td style="width:150px;">
                    <label class="hidden-for-sighted" for="operators_{{filter.name}}">{{ I18n.t('js.work_packages.description_filter') }}</label>
                    <select require
                            class="select-small to-validate"
                            id="operators-{{filter.name}}"
                            name="op[{{filter.name}}]"
                            ng-options="operator as label for (operator, label) in operatorsAndLabelsByFilterType[query.getFilterType(filter.name)]"
                            ng-model="filter.operator"
                            style="vertical-align: top;"
                            ng-disabled="disableFilters">
                    </select>
                  </td>

                  <!-- Values -->
                  <td>
                    <div id="div-values-{{filter.name}}"
                         ng-if="!showValueOptionsAsSelect"
                         ng-show="showValuesInput"
                         ng-switch="query.getFilterType(filter.name)">
                      <input ng-switch-when="string"
                             ng-model="filter.values"
                             ng-minlength="3"
                             ng-required="true"
                             class="select-small to-validate"
                             id="values-{{filter.name}}"
                             name="v_{{filter.name}}"
                             size="30"
                             type="text"
                             value=""
                             ng-disabled="disableFilters"/>
                      <label ng-switch-when="string"
                             for="values_{{name}}"
                             class="hidden-for-sighted">
                        {{ I18n.t('js.work_packages.description_enter_text') }}
                      </label>

                      <input ng-switch-when="text"
                             ng-model="filter.values"
                             ng-minlength="3"
                             ng-required="true"
                             class="select-small to-validate"
                             id="values-{{filter.name}}"
                             name="v_{{filter.name}}"
                             size="30"
                             type="text"
                             value=""
                             ng-disabled="disableFilters"/>
                      <label ng-switch-when="'text'"for="values_{{name}}" class="hidden-for-sighted">
                        {{ I18n.t('js.work_packages.description_enter_text') }}
                      </label>

                      <input ng-switch-when="integer"
                             ng-model="filter.values"
                             ng-required="true"
                             class="select-small to-validate"
                             id="values-{{filter.name}}"
                             name="v_{{filter.name}}"
                             size="3"
                             type="text"
                             value=""
                             ng-disabled="disableFilters"/>
                      <label ng-switch-when="'integer'" for="values_{{name}}" class="hidden-for-sighted">
                        {{ I18n.t('js.work_packages.description_enter_text') }}
                      </label>

                      <input ng-switch-when="date"
                             ng-model="filter.values"
                             ng-required="true"
                             class="select-small to-validate"
                             id="values-{{filter.name}}"
                             name="v_{{filter.name}}"
                             size="3"
                             type="text"
                             ng-disabled="disableFilters"/>
                      <label ng-switch-when="'date'" for="values_{{name}}" class="hidden-for-sighted">
                        {{ I18n.t('js.work_packages.time_relative.days') }}
                      </label>

                      <input ng-switch-when="date_past"
                             ng-model="filter.values"
                             ng-required="true"
                             class="select-small to-validate"
                             id="values-{{filter.name}}"
                             name="v_{{filter.name}}"
                             size="3"
                             type="text"
                             ng-disabled="disableFilters"/>
                      <label ng-switch-when="'date'" for="values_{{name}}" class="hidden-for-sighted">
                        {{ I18n.t('js.work_packages.time_relative.days') }}
                      </label>

                    </div>

                    <div ng-if="showValueOptionsAsSelect"
                         ng-show="showValuesInput">
                      <toggled-multiselect available-filter-values="query.getAvailableFilterValues(filter.name)"
                                           name="filter.name"
                                           values="filter.values"
                                           is-multiselect="false"
                                           ng-disabled="disableFilters"/>

                    </div>
                  </td>

                  <!-- Delete filter -->
                  <td>
                    <icon-wrapper icon-name="delete2"
                                  icon-title="'delete'"
                                  ng-click="query.deactivateFilter(filter, loading)"/>
                    <!-- TODO I18n -->
                  </td>
                </tr>

              </tbody>
            </table>
          </td>

          <!-- Add filters -->

          <td class="add-filter">

            <label for="add_filter_select">{{ I18n.t('js.work_packages.label_filter_add') }}</label>:
            <select class="select-small"
                    id="add_filter_select"
                    ng-change="add_filter()"
                    ng-model="filterToBeAdded"
                    ng-options="filterName as filterOptions.name || filterName
                                for (filterName, filterOptions)
                                in (query.available_work_package_filters | subtractActiveFilters:query.filters)"
                    ng-disabled="disableFilters"/>
            </select>
            <!-- TODO options | orderObjectBy: 'order' -->
          </td>

        </tr>
      </tbody>
    </table>

    <input id="f_" name="f[]" type="hidden" value=""/>

  </div>
</fieldset>
