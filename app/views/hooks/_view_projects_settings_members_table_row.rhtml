<% if not project.nil? and project.module_enabled? :costs_module and User.current.allowed_to?(:view_hourly_rates, project) %>
<% unless member.user %>
  <td class="currency"></td>
  <td align="center" style="white-space: nowrap;"></td>
<% else %>
<%
  allow_view = User.current.allowed_to?(:view_hourly_rates, project, :for => member.user)
  allow_edit = User.current.allowed_to?(:edit_hourly_rates, project, :for => member.user)
-%>

<%- if allow_view -%>
  <% rate = member.user.current_rate(project) -%>
  <td class="currency" id="rate_for_<%= member.user.id %>">
    <%= link_to number_to_currency( rate ? rate.rate : 0.0), :controller => 'hourly_rates', :action => (allow_edit ? 'edit' : 'show'), :id => member.user, :project_id => project %>
  </td>
<%- else -%>
  <td id="rate_for_<%= member.user.id %>" class="currency"></td>
<%- end -%>

<% if allow_edit %>
  <td align="center" style="white-space: nowrap;">
    <% remote_form_for :rate, :url => { :controller => 'hourly_rates', :action => 'set_rate', :id => member.user, :project_id => project}, :method => :posts  do |f| %>
      <label class="hidden-for-sighted", for="rate_text_field_for_<%= member.user.id %>"><%= l(:caption_set_rate) %></label>
      <%= f.text_field :rate, :value => "", :name => :rate, :size => 7, :id => "rate_text_field_for_#{member.user.id}"%>  <%= Setting.plugin_redmine_costs['costs_currency'] %>
      <%= image_submit_tag "save.png", :alt => l(:button_save) %>
    <% end %>
  </td>
<% else %>
  <td align="center" style="white-space: nowrap;"></td>
<% end %>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'costs', :plugin => 'redmine_costs' %>
<% end %>
<% end %>
<% end %>
