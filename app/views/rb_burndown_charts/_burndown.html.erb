<%= stylesheet_link_tag 'jqplot.css', :plugin => 'redmine_backlogs' %>

<%= javascript_include_tag_backlogs 'lib/jquery.js' %>
<!--[if IE]><%= javascript_include_tag_backlogs 'lib/jquery.flot/excanvas.js' %><![endif]-->
<%= javascript_include_tag_backlogs 'lib/jquery.cookies.2.2.0.min.js',
                                    'lib/jquery.flot/jquery.flot.js' %>

<script type="text/javascript" language="javascript">
  jQuery(function ($) {
    var Burndown = {
      datasets: { <%= burndown_dataseries(burndown).join(', ') %> },

      setDatasetColor: function () {
        var i = 0;

        $.each(Burndown.datasets, function (key, val) {
          val.color = i;
          ++i;
        });
      },

      plotAccordingToChoices: function () {
        var data = [];

        $('.burndown_control').find("input:checked").each(function () {
          var key = $(this).attr('value');

          if (key && Burndown.datasets[key]) {
            data.push(Burndown.datasets[key]);
          }
        });

        if (data.length === 0) { //in order to render an empty graph if no data is selected
          data.push({data : []});
        }

        Burndown.plot(data);
      },

      plot: function (data) {
        if (data.length > 0) {
          $.plot($(".burndown_chart"), data, {
            yaxis: { min: 0,
              ticks: [ <%= burndown_yaxis_labels(burndown) %> ] },
            xaxis: {
              ticks: [<%= burndown_xaxis_labels(burndown) %>],
              tickDecimals: 0,
              max: <%= burndown.days.length + 1 %>,
              min: 1
            }
          });
        }
      },

      init: function () {
        Burndown.setDatasetColor();
        $('#charts').height(470); //haven't figured out yet how to do this with css
        $('.burndown_control input').click(Burndown.plotAccordingToChoices);

        Burndown.plotAccordingToChoices();
      }
    };

    $(document).ready(Burndown.init);
  });
</script>