<%- charts = burndown.is_a?(Array) ? burndown : [burndown] %>
<%- dataseries = charts[0].series(:all).keys %>
<%- chart = charts[0] %>

<%= stylesheet_link_tag 'jqplot.css', :plugin => 'redmine_backlogs' %>

<%= javascript_include_tag_backlogs 'lib/jquery.js' %>
<!--[if IE]><%= javascript_include_tag_backlogs 'lib/jquery.flot/excanvas.js' %><![endif]-->
<%= javascript_include_tag_backlogs 'lib/jquery.cookies.2.2.0.min.js',
                                    'lib/jquery.flot/jquery.flot.js' %>

<script type="text/javascript" language="javascript">
  jQuery(function ($) {
    var datasets;

    datasets = { <%= burndown_dataseries(chart).join(', ') %> };

    var i = 0;
    $.each(datasets, function(key, val) {
      val.color = i;
      ++i;
    });

    function plotAccordingToChoices() {
      var data = [];

      $('.burndown_control').find("input:checked").each(function () {
        var key = $(this).attr('value');

        if (key && datasets[key]){
          data.push(datasets[key]);
        }
      });

      if(data.length == 0){ //in order to render an empty graph if no data is selected
        data.push({data : []});
      }

      plot(data);
    };

    function plot(data) {
      if (data.length > 0){
        $.plot($(".burndown_chart"), data, {
          yaxis: { min: 0,
            ticks: [ <%= burndown_yaxis_labels([chart.max[:hours], chart.max[:points]].max) %> ] },
          xaxis: {
              ticks: [<%= burndown_xaxis_labels(chart) %>],
              tickDecimals: 0,
              max: <%= chart.days.length + 1 %>
            }
        });
      };
    };

    $(document).ready(function(){
      $('#charts').height(470); //haven't figured out yet how to do this with css
      $('.burndown_control input').click(plotAccordingToChoices);

      plotAccordingToChoices();
    });
  });
</script>